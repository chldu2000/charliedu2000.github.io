<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="零歌"><meta name="copyright" content="零歌"><meta name="generator" content="Hexo 6.3.0"><meta name="theme" content="hexo-theme-yun"><title>BombLab实验 | 愚人而已</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/svg+xml" href="/afool.svg"><link rel="mask-icon" href="/afool.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"afool.top","root":"/","title":"愚人而已","version":"1.10.9","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><link rel="alternate" href="/atom.xml" title="愚人而已" type="application/atom+xml"><meta name="description" content="拆掉邪恶博士的炸弹 这是一个课程实验，感觉有点意思，就记录一下吧。 分析可能不准确，仅供参考。  邪恶博士的幽默感&#x2F;***************************************************************************  * Dr. Evil&#39;s Insidious Bomb, Version 1.1  * Copyright 20">
<meta property="og:type" content="article">
<meta property="og:title" content="BombLab实验">
<meta property="og:url" content="https://afool.top/learning/csapp_bomblab/">
<meta property="og:site_name" content="愚人而已">
<meta property="og:description" content="拆掉邪恶博士的炸弹 这是一个课程实验，感觉有点意思，就记录一下吧。 分析可能不准确，仅供参考。  邪恶博士的幽默感&#x2F;***************************************************************************  * Dr. Evil&#39;s Insidious Bomb, Version 1.1  * Copyright 20">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2021/06/05/xodRVhpKkq7BUI5.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/yXM4Omd15wWbu8V.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/kXyj7TLxtaJEIB3.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/EhNXclznmLyHFGs.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/nWz8EwikTUpqQ3d.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/rig7bMAeZzaQyk1.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/IYUkiuCAZMjdDzb.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/4yp7FVA1wiEMkrI.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/x7tO5IuYpvTCgKE.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/CRqUj6n8Ki7ZlDd.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/rIbYyvn1j2AHZa7.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/oSlURyD4XP8NbhZ.jpg">
<meta property="og:image" content="https://i.loli.net/2021/06/05/TpuSW5DxAa8yQje.jpg">
<meta property="article:published_time" content="2021-05-14T15:52:00.000Z">
<meta property="article:modified_time" content="2022-11-07T08:43:40.831Z">
<meta property="article:author" content="零歌">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2021/06/05/xodRVhpKkq7BUI5.jpg"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="零歌"><img width="96" loading="lazy" src="/images/nekosense.jpeg" alt="零歌"></a><div class="site-author-name"><a href="/about/">零歌</a></div><span class="site-name">愚人而已</span><sub class="site-subtitle">以愚者之名攀上顶峰</sub><div class="site-description"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">46</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">5</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">34</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:rss-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/charliedu2000" title="GitHub" target="_blank" style="color:#6e5494"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=610609902" title="网易云音乐" target="_blank" style="color:#C20C0C"><span class="icon iconify" data-icon="ri:netease-cloud-music-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/22660607" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><span class="icon iconify" data-icon="ri:bilibili-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:charliedu2000@hotmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="旁友们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%86%E6%8E%89%E9%82%AA%E6%81%B6%E5%8D%9A%E5%A3%AB%E7%9A%84%E7%82%B8%E5%BC%B9"><span class="toc-number">1.</span> <span class="toc-text">拆掉邪恶博士的炸弹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%AA%E6%81%B6%E5%8D%9A%E5%A3%AB%E7%9A%84%E5%B9%BD%E9%BB%98%E6%84%9F"><span class="toc-number">1.1.</span> <span class="toc-text">邪恶博士的幽默感</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E5%85%B3"><span class="toc-number">1.2.</span> <span class="toc-text">第一关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E5%85%B3"><span class="toc-number">1.3.</span> <span class="toc-text">第二关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E5%85%B3"><span class="toc-number">1.4.</span> <span class="toc-text">第三关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E5%85%B3"><span class="toc-number">1.5.</span> <span class="toc-text">第四关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E5%85%B3"><span class="toc-number">1.6.</span> <span class="toc-text">第五关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E5%85%B3"><span class="toc-number">1.7.</span> <span class="toc-text">第六关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E8%97%8F%E5%85%B3%E5%8D%A1"><span class="toc-number">1.8.</span> <span class="toc-text">隐藏关卡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.8.1.</span> <span class="toc-text">进入条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90secret-phase"><span class="toc-number">1.8.2.</span> <span class="toc-text">分析secret_phase</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E5%85%B3"><span class="toc-number">1.9.</span> <span class="toc-text">通关</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://afool.top/learning/csapp_bomblab/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="零歌"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="愚人而已"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">BombLab实验</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2021-05-14 23:52:00" itemprop="dateCreated datePublished" datetime="2021-05-14T23:52:00+08:00">2021-05-14</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><span class="icon iconify" data-icon="ri:file-word-line"></span></span> <span title="本文字数">6k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><span class="icon iconify" data-icon="ri:timer-line"></span></span> <span title="阅读时长">30m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%BF%AB%E5%8E%BB%E5%AD%A6%E4%B9%A0/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">快去学习</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">学习笔记</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="拆掉邪恶博士的炸弹"><a href="#拆掉邪恶博士的炸弹" class="headerlink" title="拆掉邪恶博士的炸弹"></a>拆掉邪恶博士的炸弹</h2><blockquote>
<p>这是一个课程实验，感觉有点意思，就记录一下吧。</p>
<p>分析可能不准确，仅供参考。</p>
</blockquote>
<h3 id="邪恶博士的幽默感"><a href="#邪恶博士的幽默感" class="headerlink" title="邪恶博士的幽默感"></a>邪恶博士的幽默感</h3><pre class="language-none"><code class="language-none">&#x2F;***************************************************************************
 * Dr. Evil&#39;s Insidious Bomb, Version 1.1
 * Copyright 2011, Dr. Evil Incorporated. All rights reserved.
 *
 * LICENSE:
 *
 * Dr. Evil Incorporated (the PERPETRATOR) hereby grants you (the
 * VICTIM) explicit permission to use this bomb (the BOMB).  This is a
 * time limited license, which expires on the death of the VICTIM.
 * The PERPETRATOR takes no responsibility for damage, frustration,
 * insanity, bug-eyes, carpal-tunnel syndrome, loss of sleep, or other
 * harm to the VICTIM.  Unless the PERPETRATOR wants to take credit,
 * that is.  The VICTIM may not distribute this bomb source code to
 * any enemies of the PERPETRATOR.  No VICTIM may debug,
 * reverse-engineer, run &quot;strings&quot; on, decompile, decrypt, or use any
 * other technique to gain knowledge of and defuse the BOMB.  BOMB
 * proof clothing may not be worn when handling this program.  The
 * PERPETRATOR will not apologize for the PERPETRATOR&#39;s poor sense of
 * humor.  This license is null and void where the BOMB is prohibited
 * by law.
 ***************************************************************************&#x2F;</code></pre>

<p>满满的中二之感，连我都看不惯了，解之。</p>
<p>由于我们并没有完整的源代码，只能通过汇编代码来尝试推出博士<del>这个邪恶的刀客塔</del>到底在炸弹里做了些什么手脚了。</p>
<span id="more"></span>

<h3 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h3><pre class="language-none"><code class="language-none">&#x2F;* Hmm...  Six phases must be more secure than one phase! *&#x2F;</code></pre>

<p>邪恶博士的第一个关卡如下</p>
<pre class="language-none"><code class="language-none">08048b50 &lt;phase_1&gt;:
 8048b50:   83 ec 1c                sub    $0x1c,%esp
 8048b53:   c7 44 24 04 64 a1 04    movl   $0x804a164,0x4(%esp)
 8048b5a:   08 
 8048b5b:   8b 44 24 20             mov    0x20(%esp),%eax
 8048b5f:   89 04 24                mov    %eax,(%esp)
 8048b62:   e8 2d 04 00 00          call   8048f94 &lt;strings_not_equal&gt;
 8048b67:   85 c0                   test   %eax,%eax
 8048b69:   74 05                   je     8048b70 &lt;phase_1+0x20&gt;
 8048b6b:   e8 36 05 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048b70:   83 c4 1c                add    $0x1c,%esp
 8048b73:   c3                      ret</code></pre>

<p>看起来很短，大概是这样的：</p>
<p>把输入的内容传给了<code>phase_1</code>，根据<code>phase_1</code>调用了<code>&lt;strings_not_equal&gt;</code>猜想这里应该是把输入的字符串和某个字符串作比较，下面<code>test %eax,%eax</code>，当<code>%eax</code>为0时跳过<code>&lt;explode_bomb&gt;</code>，即<code>&lt;strings_not_equal&gt;</code>的返回值为0，两个字符串相等时跳过。</p>
<p>在<code>&lt;strings_not_equal&gt;</code>之前可以看到<code>movl $0x804a164,0x4(%esp)</code>，将这个立即数作为地址。使用gdb调试bomb程序，输入<code>x/s 0x804a164</code>，终端显示了<code>0x804a164: &quot;Crikey! I have lost my mojo!&quot;</code>。</p>
<p>再往下是<code>mov 0x20(%esp),%eax</code>，把手动输入的字符串的地址放进<code>%eax</code>，再放到<code>(%esp)</code>，传给了<code>&lt;strings_not_equal&gt;</code>。猜测需要输入的正确答案就是<code>0x804a164</code>处的字符串<code>Crikey! I have lost my mojo!</code>。</p>
<p>在<code>&lt;explode_bomb&gt;</code>前设置断点，<code>break explode_bomb</code>，输入run运行程序。输入字符串<code>Crikey! I have lost my mojo!</code>，终端显示<code>Phase 1 defused. How about the next one?</code>，第一关通过。</p>
<p><img src="https://i.loli.net/2021/06/05/xodRVhpKkq7BUI5.jpg" alt="phase1" loading="lazy"></p>
<h3 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h3><pre class="language-none"><code class="language-none">&#x2F;* The second phase is harder.  No one will ever figure out
 * how to defuse this... *&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">08048b74 &lt;phase_2&gt;:
 8048b74:   56                      push   %esi
 8048b75:   53                      push   %ebx
 8048b76:   83 ec 34                sub    $0x34,%esp
 8048b79:   8d 44 24 18             lea    0x18(%esp),%eax
 8048b7d:   89 44 24 04             mov    %eax,0x4(%esp)
 8048b81:   8b 44 24 40             mov    0x40(%esp),%eax
 8048b85:   89 04 24                mov    %eax,(%esp)
 8048b88:   e8 4e 06 00 00          call   80491db &lt;read_six_numbers&gt;
 8048b8d:   83 7c 24 18 00          cmpl   $0x0,0x18(%esp)
 8048b92:   75 07                   jne    8048b9b &lt;phase_2+0x27&gt;
 8048b94:   83 7c 24 1c 01          cmpl   $0x1,0x1c(%esp)
 8048b99:   74 05                   je     8048ba0 &lt;phase_2+0x2c&gt;
 8048b9b:   e8 06 05 00 00          call   80490a6 &lt;explode_bomb&gt;</code></pre>

<p>由<code>&lt;read_six_numbers&gt;</code>可以猜想第二关要输入六个数。紧接着是<code>cmpl  $0x0,0x18(%esp)</code>和<code>jne 8048b9b &lt;phase_2+0x27&gt;</code>，而<code>8048b9b</code>处就是调用<code>&lt;explode_bomb&gt;</code>，也就是说如果第一个数不等于0就爆炸，所以第一个数是0。</p>
<p>再往下是<code>cmpl $0x1,0x1c(%esp)</code>和<code>je 8048ba0 &lt;phase_2+0x2c&gt;</code>，第二个数等于1就跳过爆炸。</p>
<pre class="language-none"><code class="language-none">8048ba0:   8d 5c 24 20             lea    0x20(%esp),%ebx
 8048ba4:   8d 74 24 30             lea    0x30(%esp),%esi
 8048ba8:   8b 43 f8                mov    -0x8(%ebx),%eax
 8048bab:   03 43 fc                add    -0x4(%ebx),%eax
 8048bae:   39 03                   cmp    %eax,(%ebx)
 8048bb0:   74 05                   je     8048bb7 &lt;phase_2+0x43&gt;
 8048bb2:   e8 ef 04 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048bb7:   83 c3 04                add    $0x4,%ebx
 8048bba:   39 f3                   cmp    %esi,%ebx
 8048bbc:   75 ea                   jne    8048ba8 &lt;phase_2+0x34&gt;
 8048bbe:   83 c4 34                add    $0x34,%esp
 8048bc1:   5b                      pop    %ebx
 8048bc2:   5e                      pop    %esi
 8048bc3:   c3                      ret</code></pre>

<p>接着是循环遍历剩下的数，由<code>mov -0x8(%ebx),%eax</code>、<code>add -0x4(%ebx),%eax</code>、<code>cmp %eax,(%ebx)</code>可以发现是用当前数与它前面两个数之和比较，相等就不爆炸，也就是说输入的数应该组成斐波那契数列，已经有了0和1，剩下的应该是1、2、3、5。</p>
<p>在终端输入<code>0 1 1 2 3 5</code>，终端输出了<code>That&#39;s number 2. Keep going!</code>，第二关通过。</p>
<p><img src="https://i.loli.net/2021/06/05/yXM4Omd15wWbu8V.jpg" alt="phase2" loading="lazy"></p>
<h3 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h3><pre class="language-none"><code class="language-none">&#x2F;* I guess this is too easy so far.  Some more complex code will
 * confuse people. *&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">08048bc4 &lt;phase_3&gt;:
 8048bc4:   83 ec 2c                sub    $0x2c,%esp
 8048bc7:   8d 44 24 1c             lea    0x1c(%esp),%eax
 8048bcb:   89 44 24 0c             mov    %eax,0xc(%esp)
 8048bcf:   8d 44 24 18             lea    0x18(%esp),%eax
 8048bd3:   89 44 24 08             mov    %eax,0x8(%esp)
 8048bd7:   c7 44 24 04 8b a3 04    movl   $0x804a38b,0x4(%esp)
 8048bde:   08 
 8048bdf:   8b 44 24 30             mov    0x30(%esp),%eax
 8048be3:   89 04 24                mov    %eax,(%esp)
 8048be6:   e8 85 fc ff ff          call   8048870 &lt;__isoc99_sscanf@plt&gt;
 8048beb:   83 f8 01                cmp    $0x1,%eax
 8048bee:   7f 05                   jg     8048bf5 &lt;phase_3+0x31&gt;
 8048bf0:   e8 b1 04 00 00          call   80490a6 &lt;explode_bomb&gt;</code></pre>

<p>由<code>movl $0x804a38b,0x4(%esp)</code>可以猜想<code>0x804a38b</code>中保存的内容与<code>sscanf</code>有关。在gdb中输入<code>x/s 0x804a38b</code>，终端输出了<code>0x804a38b: &quot;%d %d&quot;</code>，猜想应该输入两个整数，<code>sscanf</code>的返回值与1比较，返回值（输入数的个数）大于1才能不爆炸。</p>
<pre class="language-none"><code class="language-none">8048bf5:   83 7c 24 18 07          cmpl   $0x7,0x18(%esp)
 8048bfa:   77 3c                   ja     8048c38 &lt;phase_3+0x74&gt;</code></pre>

<p>输入的第一个数与7比较，小于等于7才不爆炸。</p>
<pre class="language-none"><code class="language-none">8048bfc:   8b 44 24 18             mov    0x18(%esp),%eax
 8048c00:   ff 24 85 a0 a1 04 08    jmp    *0x804a1a0(,%eax,4)</code></pre>

<p>猜测是<code>switch</code>，使用以<code>*0x804a1a0</code>为基址的跳转表。</p>
<pre class="language-none"><code class="language-none">8048c07:   b8 f5 02 00 00          mov    $0x2f5,%eax
 8048c0c:   eb 3b                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c0e:   b8 ad 03 00 00          mov    $0x3ad,%eax
 8048c13:   eb 34                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c15:   b8 0e 02 00 00          mov    $0x20e,%eax
 8048c1a:   eb 2d                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c1c:   b8 e3 03 00 00          mov    $0x3e3,%eax
 8048c21:   eb 26                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c23:   b8 e0 03 00 00          mov    $0x3e0,%eax
 8048c28:   eb 1f                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c2a:   b8 a3 02 00 00          mov    $0x2a3,%eax
 8048c2f:   eb 18                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c31:   b8 5e 01 00 00          mov    $0x15e,%eax
 8048c36:   eb 11                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c38:   e8 69 04 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048c3d:   b8 00 00 00 00          mov    $0x0,%eax
 8048c42:   eb 05                   jmp    8048c49 &lt;phase_3+0x85&gt;
 8048c44:   b8 13 03 00 00          mov    $0x313,%eax
 8048c49:   3b 44 24 1c             cmp    0x1c(%esp),%eax
 8048c4d:   74 05                   je     8048c54 &lt;phase_3+0x90&gt;
 8048c4f:   e8 52 04 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048c54:   83 c4 2c                add    $0x2c,%esp
 8048c57:   c3                      ret</code></pre>

<p>输入<code>p/x *0x804a1a0</code>，终端输出了<code>&quot;$1 = 0x8048c07&quot;</code>，那么第一个数是0时，第二个数应该是<code>0x8048c07</code>处<code>mov $0x2f5,%eax</code>对应的数0x2f5，转换成十进制就是757。当第一个数是其他值时第二个数会有不同，比如当第一个数是2，通过<code>p/x *0x804a1a8</code>得到<code>$3 = 0x8048c0e</code>，第二个数应该是0x3ad，转换成十进制是941，其他情况不再一一列出。</p>
<p>输入<code>0 757</code>，终端输出了<code>Halfway there!</code>，第三关通过，答案不唯一。</p>
<p><img src="https://i.loli.net/2021/06/05/kXyj7TLxtaJEIB3.jpg" alt="phase3" loading="lazy"></p>
<h3 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h3><pre class="language-none"><code class="language-none">&#x2F;* Oh yeah?  Well, how good is your math?  Try on this saucy problem! *&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">08048cb5 &lt;phase_4&gt;:
 8048cb5:   83 ec 2c                sub    $0x2c,%esp
 8048cb8:   8d 44 24 18             lea    0x18(%esp),%eax
 8048cbc:   89 44 24 0c             mov    %eax,0xc(%esp)
 8048cc0:   8d 44 24 1c             lea    0x1c(%esp),%eax
 8048cc4:   89 44 24 08             mov    %eax,0x8(%esp)
 8048cc8:   c7 44 24 04 8b a3 04    movl   $0x804a38b,0x4(%esp)
 8048ccf:   08 
 8048cd0:   8b 44 24 30             mov    0x30(%esp),%eax
 8048cd4:   89 04 24                mov    %eax,(%esp)
 8048cd7:   e8 94 fb ff ff          call   8048870 &lt;__isoc99_sscanf@plt&gt;
 8048cdc:   83 f8 02                cmp    $0x2,%eax
 8048cdf:   75 0e                   jne    8048cef &lt;phase_4+0x3a&gt;
 8048ce1:   8b 44 24 18             mov    0x18(%esp),%eax
 8048ce5:   83 f8 01                cmp    $0x1,%eax
 8048ce8:   7e 05                   jle    8048cef &lt;phase_4+0x3a&gt;</code></pre>

<p>根据<code>movl $0x804a38b,0x4(%esp)</code>，输入<code>x/s 0x804a38b</code>，得到<code>&quot;0x804a38b: &quot;%d %d&quot;&quot;</code>，猜想应该输入两个整数。接下来<code>sscanf</code>返回值等于2就不爆炸，说明接受的输入数量是2个。</p>
<p>在这种情况下<code>&quot;%d %d&quot;</code>指定了<code>sscanf</code>接受的输入类型，使它只能接受两个输入，输入元素的数量大于2时返回值也是2，这样<code>secret_phase</code>的进入条件不会影响<code>phase_4</code>的正常通关。</p>
<pre class="language-none"><code class="language-none">8048cea:   83 f8 04                cmp    $0x4,%eax
 8048ced:   7e 05                   jle    8048cf4 &lt;phase_4+0x3f&gt;
 8048cef:   e8 b2 03 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048cf4:   8b 44 24 18             mov    0x18(%esp),%eax
 8048cf8:   89 44 24 04             mov    %eax,0x4(%esp)
 8048cfc:   c7 04 24 06 00 00 00    movl   $0x6,(%esp)
 8048d03:   e8 50 ff ff ff          call   8048c58 &lt;func4&gt;</code></pre>

<p><code>mov 0x18(%esp),%eax</code>、<code>cmp $0x1,%eax</code>和<code>cmp $0x4,%eax</code>限定输入的第二个数应该大于1且小于等于4，再将6和输入的第二个数（这里记作x和y）传入<code>func4</code>。</p>
<p>func4：</p>
<pre class="language-none"><code class="language-none">08048c58 &lt;func4&gt;:
 8048c58:   83 ec 1c                sub    $0x1c,%esp
 8048c5b:   89 5c 24 10             mov    %ebx,0x10(%esp)
 8048c5f:   89 74 24 14             mov    %esi,0x14(%esp)
 8048c63:   89 7c 24 18             mov    %edi,0x18(%esp)
 8048c67:   8b 74 24 20             mov    0x20(%esp),%esi
 8048c6b:   8b 5c 24 24             mov    0x24(%esp),%ebx
 8048c6f:   85 f6                   test   %esi,%esi
 8048c71:   7e 2b                   jle    8048c9e &lt;func4+0x46&gt;
 8048c73:   83 fe 01                cmp    $0x1,%esi
 8048c76:   74 2b                   je     8048ca3 &lt;func4+0x4b&gt;</code></pre>

<p>先判断x是否等于0，等于0则返回0；再判断x是否为1，为1则返回y。</p>
<pre class="language-none"><code class="language-none">8048c78:   89 5c 24 04             mov    %ebx,0x4(%esp)
 8048c7c:   8d 46 ff                lea    -0x1(%esi),%eax
 8048c7f:   89 04 24                mov    %eax,(%esp)
 8048c82:   e8 d1 ff ff ff          call   8048c58 &lt;func4&gt;
 8048c87:   8d 3c 18                lea    (%eax,%ebx,1),%edi
 8048c8a:   89 5c 24 04             mov    %ebx,0x4(%esp)
 8048c8e:   83 ee 02                sub    $0x2,%esi
 8048c91:   89 34 24                mov    %esi,(%esp)
 8048c94:   e8 bf ff ff ff          call   8048c58 &lt;func4&gt;
 8048c99:   8d 1c 07                lea    (%edi,%eax,1),%ebx
 8048c9c:   eb 05                   jmp    8048ca3 &lt;func4+0x4b&gt;
 8048c9e:   bb 00 00 00 00          mov    $0x0,%ebx
 8048ca3:   89 d8                   mov    %ebx,%eax
 8048ca5:   8b 5c 24 10             mov    0x10(%esp),%ebx
 8048ca9:   8b 74 24 14             mov    0x14(%esp),%esi
 8048cad:   8b 7c 24 18             mov    0x18(%esp),%edi
 8048cb1:   83 c4 1c                add    $0x1c,%esp
 8048cb4:   c3                      ret</code></pre>

<p>剩下的部分，即x大于1时，把x-1的值和y当作参数调用<code>func4</code>，返回值与y相加后存到<code>%edi</code>，接着与这里类似，x减去2，把<code>x-2</code>和<code>y</code>当作参数调用<code>func4</code>，返回值与之前存在<code>%edi</code>中的值相加，所得结果作为返回值。</p>
<p>推测func4如下：</p>
<pre class="language-none"><code class="language-none">int func4(int x, int y) &#123;
  if(x &#x3D;&#x3D; 0) &#123;
    return 0;
  &#125;
  else if(x &#x3D;&#x3D; 1) &#123;
    return y;
  &#125;
  else &#123;
    return func4(x-1, y)+y+func4(x-2, y);
  &#125;
&#125;</code></pre>

<p>回到<code>phase4</code>：</p>
<pre class="language-none"><code class="language-none">8048d08:   3b 44 24 1c             cmp    0x1c(%esp),%eax
 8048d0c:   74 05                   je     8048d13 &lt;phase_4+0x5e&gt;
 8048d0e:   e8 93 03 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048d13:   83 c4 2c                add    $0x2c,%esp
 8048d16:   c3                      ret</code></pre>

<p><code>cmp 0x1c(%esp),%eax</code>，将<code>func4</code>的返回值与输入的第一个数比较，相等就跳过爆炸，那么输入的第一个数应该等于<code>func4</code>的返回值，该返回值与输入的第二个数有关，答案不唯一。</p>
<p>当输入的第二个数为4时，<code>func4</code>的返回值应该是80。</p>
<p>输入80 4，终端输出了<code>So you got that one. Try this one.</code>，第四关通过。</p>
<p><img src="https://i.loli.net/2021/06/05/EhNXclznmLyHFGs.jpg" alt="phase4" loading="lazy"></p>
<h3 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h3><pre class="language-none"><code class="language-none">&#x2F;* Round and &#39;round in memory we go, where we stop, the bomb blows! *&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">08048d17 &lt;phase_5&gt;:
 8048d17:   53                      push   %ebx
 8048d18:   83 ec 18                sub    $0x18,%esp
 8048d1b:   8b 5c 24 20             mov    0x20(%esp),%ebx
 8048d1f:   89 1c 24                mov    %ebx,(%esp)
 8048d22:   e8 54 02 00 00          call   8048f7b &lt;string_length&gt;
 8048d27:   83 f8 06                cmp    $0x6,%eax
 8048d2a:   74 05                   je     8048d31 &lt;phase_5+0x1a&gt;
 8048d2c:   e8 75 03 00 00          call   80490a6 &lt;explode_bomb&gt;</code></pre>

<p>将输入的内容传到<code>(%esp)</code>再调用<code>&lt;string_length&gt;</code>，获取字符串长度并与6比较，长度为6才不爆炸。</p>
<pre class="language-none"><code class="language-none">8048d31:   ba 00 00 00 00          mov    $0x0,%edx
 8048d36:   b8 00 00 00 00          mov    $0x0,%eax
 8048d3b:   0f be 0c 03             movsbl (%ebx,%eax,1),%ecx
 8048d3f:   83 e1 0f                and    $0xf,%ecx
 8048d42:   03 14 8d c0 a1 04 08    add    0x804a1c0(,%ecx,4),%edx
 8048d49:   83 c0 01                add    $0x1,%eax
 8048d4c:   83 f8 06                cmp    $0x6,%eax
 8048d4f:   75 ea                   jne    8048d3b &lt;phase_5+0x24&gt;</code></pre>

<p>接下来是一个循环，用<code>movsbl (%ebx,%eax,1),%ecx</code>和<code>and $0xf,%ecx</code>获得输入的字符串中每个字符的二进制编码低四位，<code>add 0x804a1c0(,%ecx,4),%edx</code>以每一步的四位编码作为偏移量在数组中找到对应的数，做累加，存到<code>%edx</code>。</p>
<pre class="language-none"><code class="language-none">8048d51:   83 fa 35                cmp    $0x35,%edx
 8048d54:   74 05                   je     8048d5b &lt;phase_5+0x44&gt;
 8048d56:   e8 4b 03 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048d5b:   83 c4 18                add    $0x18,%esp
 8048d5e:   5b                      pop    %ebx
 8048d5f:   90                      nop
 8048d60:   c3                      ret</code></pre>

<p>这里<code>cmp $0x35,%edx</code>，将上一步获得的结果与0x35（转化成十进制是53）比较，相等则跳过爆炸。</p>
<p>在gdb中输入<code>x/16d 0x804a1c0</code>，以十进制有符号数格式显示数组中的部分数值：</p>
<p><img src="https://i.loli.net/2021/06/05/nWz8EwikTUpqQ3d.jpg" alt="nums" loading="lazy"></p>
<p>只要输入的六个字符编码低四位作为偏移量对应数组元素之和等于53即可。比如输入字符a，ASCII码是<code>01100001</code>，低四位是<code>0001</code>，那么对应的数组元素就是<code>10</code>。按照这个方法可以得出一组可能的答案：<code>dehifk</code>。答案不唯一。</p>
<p>输入<code>dehifk</code>，终端输出<code>Good work! On to the next...</code>，第五关通过。</p>
<p><img src="https://i.loli.net/2021/06/05/rig7bMAeZzaQyk1.jpg" alt="phase5" loading="lazy"></p>
<h3 id="第六关"><a href="#第六关" class="headerlink" title="第六关"></a>第六关</h3><pre class="language-none"><code class="language-none">&#x2F;* This phase will never be used, since no one will get past the
 * earlier ones.  But just in case, make this one extra hard. *&#x2F;</code></pre>

<pre class="language-none"><code class="language-none">08048d61 &lt;phase_6&gt;:
 8048d61:   56                      push   %esi
 8048d62:   53                      push   %ebx
 8048d63:   83 ec 44                sub    $0x44,%esp
 8048d66:   8d 44 24 10             lea    0x10(%esp),%eax
 8048d6a:   89 44 24 04             mov    %eax,0x4(%esp)
 8048d6e:   8b 44 24 50             mov    0x50(%esp),%eax
 8048d72:   89 04 24                mov    %eax,(%esp)
 8048d75:   e8 61 04 00 00          call   80491db &lt;read_six_numbers&gt;</code></pre>

<p>由<code>&lt;read_six_numbers&gt;</code>可以看出这一关需要输入六个数。</p>
<pre class="language-none"><code class="language-none">8048d7a:   be 00 00 00 00          mov    $0x0,%esi
 8048d7f:   8b 44 b4 10             mov    0x10(%esp,%esi,4),%eax
 8048d83:   83 e8 01                sub    $0x1,%eax
 8048d86:   83 f8 05                cmp    $0x5,%eax
 8048d89:   76 05                   jbe    8048d90 &lt;phase_6+0x2f&gt;
 8048d8b:   e8 16 03 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048d90:   83 c6 01                add    $0x1,%esi
 8048d93:   83 fe 06                cmp    $0x6,%esi
 8048d96:   74 33                   je     8048dcb &lt;phase_6+0x6a&gt;</code></pre>

<p>这里进入一个循环，由<code>$0x0,%esi、mov 0x10(%esp,%esi,4),%eax</code>、<code>sub $0x1,%eax</code>和<code>cmp $0x5,%eax</code>发现输入的数必须小于等于6（注意<code>%eax</code>与5比较之前减去了1），<code>add $0x1,%esi、cmp $0x6,%esi</code>是循环条件，保证遍历输入的6个数，确定其大小。</p>
<pre class="language-none"><code class="language-none">8048d98:   89 f3                   mov    %esi,%ebx
 8048d9a:   8b 44 9c 10             mov    0x10(%esp,%ebx,4),%eax
 8048d9e:   39 44 b4 0c             cmp    %eax,0xc(%esp,%esi,4)
 8048da2:   75 05                   jne    8048da9 &lt;phase_6+0x48&gt;
 8048da4:   e8 fd 02 00 00          call   80490a6 &lt;explode_bomb&gt;
 8048da9:   83 c3 01                add    $0x1,%ebx
 8048dac:   83 fb 05                cmp    $0x5,%ebx
 8048daf:   7e e9                   jle    8048d9a &lt;phase_6+0x39&gt;
 8048db1:   eb cc                   jmp    8048d7f &lt;phase_6+0x1e&gt;</code></pre>

<p>判断完一个数（记为<code>x</code>）的大小后进行嵌套的循环，其中<code>mov 0x10(%esp,%ebx,4),%eax</code>和<code>cmp %eax,0xc(%esp,%esi,4)</code>把后面的数和x进行比较，不相等才不会引发爆炸。这一层循环比较x和它后面的所有数。这两层循环就能确定输入的所有数都不相等。</p>
<pre class="language-none"><code class="language-none">8048db3:   8b 52 08                mov    0x8(%edx),%edx
 8048db6:   83 c0 01                add    $0x1,%eax
 8048db9:   39 c8                   cmp    %ecx,%eax
 8048dbb:   75 f6                   jne    8048db3 &lt;phase_6+0x52&gt;
​
 8048dbd:   89 54 b4 28             mov    %edx,0x28(%esp,%esi,4);
 8048dc1:   83 c3 01                add    $0x1,%ebx
 8048dc4:   83 fb 06                cmp    $0x6,%ebx
 8048dc7:   75 07                   jne    8048dd0 &lt;phase_6+0x6f&gt;;
 8048dc9:   eb 1c                   jmp    8048de7 &lt;phase_6+0x86&gt;
​
 8048dcb:   bb 00 00 00 00          mov    $0x0,%ebx
​
 8048dd0:   89 de                   mov    %ebx,%esi
 8048dd2:   8b 4c 9c 10             mov    0x10(%esp,%ebx,4),%ecx
 8048dd6:   b8 01 00 00 00          mov    $0x1,%eax
 8048ddb:   ba 3c c1 04 08          mov    $0x804c13c,%edx
 8048de0:   83 f9 01                cmp    $0x1,%ecx
 8048de3:   7f ce                   jg     8048db3 &lt;phase_6+0x52&gt;
 8048de5:   eb d6                   jmp    8048dbd &lt;phase_6+0x5c&gt;</code></pre>

<p>做完之前的检查后程序跳到了<code>8048dcb</code>对应的行，这里也是一个循环，在这个循环中，以<code>0x804c13c</code>为基址，之前输入的数减1再乘8作为偏移量，按数被输入的顺序将对应的元素存入栈帧。</p>
<p>输入<code>x/20wx 0x804c13c</code>，得到如下内容：</p>
<p><img src="https://i.loli.net/2021/06/05/IYUkiuCAZMjdDzb.jpg" alt="contents" loading="lazy"></p>
<p>可以发现前面保存的内容都是地址的形式。由这些内容还可以看出应该输入的数是1到6这六个数。</p>
<p>如果输入的第一个数是<code>2</code>，那么偏移量是<code>8</code>，保存的地址就是<code>0x804c144</code>处的内容<code>0x804c148</code>。</p>
<pre class="language-none"><code class="language-none">8048de7:   8b 5c 24 28             mov    0x28(%esp),%ebx
 8048deb:   8b 44 24 2c             mov    0x2c(%esp),%eax
 8048def:   89 43 08                mov    %eax,0x8(%ebx)
 8048df2:   8b 54 24 30             mov    0x30(%esp),%edx
 8048df6:   89 50 08                mov    %edx,0x8(%eax)
 8048df9:   8b 44 24 34             mov    0x34(%esp),%eax
 8048dfd:   89 42 08                mov    %eax,0x8(%edx)
 8048e00:   8b 54 24 38             mov    0x38(%esp),%edx
 8048e04:   89 50 08                mov    %edx,0x8(%eax)
 8048e07:   8b 44 24 3c             mov    0x3c(%esp),%eax
 8048e0b:   89 42 08                mov    %eax,0x8(%edx)
 8048e0e:   c7 40 08 00 00 00 00    movl   $0x0,0x8(%eax)</code></pre>

<p>之前保存完地址之后，程序按顺序将这些地址指向的数也保存进栈帧，按照上面假设的情况，保存的第一项是<code>0x143</code>。</p>
<pre class="language-none"><code class="language-none">8048e15:   be 05 00 00 00          mov    $0x5,%esi
 8048e1a:   8b 43 08                mov    0x8(%ebx),%eax
 8048e1d:   8b 10                   mov    (%eax),%edx
 8048e1f:   39 13                   cmp    %edx,(%ebx)
 8048e21:   7e 05                   jle    8048e28 &lt;phase_6+0xc7&gt;
 8048e23:   e8 7e 02 00 00          call   80490a6 &lt;explode_bomb&gt;
​
 8048e28:   8b 5b 08                mov    0x8(%ebx),%ebx
 8048e2b:   83 ee 01                sub    $0x1,%esi
 8048e2e:   75 ea                   jne    8048e1a &lt;phase_6+0xb9&gt;；aaa
​
 8048e30:   83 c4 44                add    $0x44,%esp
 8048e33:   5b                      pop    %ebx
 8048e34:   5e                      pop    %esi
 8048e35:   c3                      ret</code></pre>

<p>在这之后，进行比较排序。<code>mov 0x8(%ebx),%eax</code>、<code>mov (%eax),%edx</code>和<code>cmp %edx,(%ebx)</code>每次都取一项与前一项进行比较，前一项小于后一项才不会爆炸。<code>sub  $0x1,%esi</code>、<code>jne 8048e1a &lt;phase_6+0xb9&gt;</code>是循环条件。</p>
<p>可以发现保存的数与输入的数的对应关系：</p>
<pre class="language-none"><code class="language-none">277 1
143 2
1f3 3
31d 4
281 5
8c  6</code></pre>

<p>按升序排列：</p>
<pre class="language-none"><code class="language-none">8c  6
143 2
1f3 3
277 1
281 5
31d 4</code></pre>

<p>也就是说输入数的顺序应该是6、2、3、1、5、4。</p>
<p>输入<code>6 2 3 1 5 4</code>，终端输出了<code>Congratulations! You&#39;ve defused the bomb!</code>，第六关通过。</p>
<p><img src="https://i.loli.net/2021/06/05/4yp7FVA1wiEMkrI.jpg" alt="phase6" loading="lazy"></p>
<h3 id="隐藏关卡"><a href="#隐藏关卡" class="headerlink" title="隐藏关卡"></a>隐藏关卡</h3><p>看起来我们已经解决了所有问题，但是事情好像并不像我们想得那么简单。</p>
<pre class="language-none"><code class="language-none">&#x2F;* Wow, they got it!  But isn&#39;t something... missing?  Perhaps
 * something they overlooked?  Mua ha ha ha ha! *&#x2F;</code></pre>

<p>这赤裸裸的嘲讽，能忍吗？（doge）</p>
<p>发现汇编代码中存在<code>secret_phase</code>，但是之前的过程并没有用到，猜测它是一个隐藏关卡。</p>
<h4 id="进入条件"><a href="#进入条件" class="headerlink" title="进入条件"></a>进入条件</h4><p>为了找到进入该关卡的条件，在汇编代码中寻找<code>secret_phase</code>，发现只有<code>phase_defused</code>调用了该函数。</p>
<p>首先分析<code>phase_defused</code>，它在通过每一个关卡后被调用。</p>
<pre class="language-none"><code class="language-none">0804922b &lt;phase_defused&gt;:
 804922b:   81 ec 8c 00 00 00       sub    $0x8c,%esp
 8049231:   65 a1 14 00 00 00       mov    %gs:0x14,%eax
 8049237:   89 44 24 7c             mov    %eax,0x7c(%esp)
 804923b:   31 c0                   xor    %eax,%eax
 804923d:   83 3d cc c3 04 08 06    cmpl   $0x6,0x804c3cc
 8049244:   75 72                   jne    80492b8 &lt;phase_defused+0x8d&gt;</code></pre>

<p><code>cmpl $0x6,0x804c3cc</code>可能与通过之前六关有关，没有全部通过就不会触发隐藏关卡。</p>
<pre class="language-none"><code class="language-none">8049246:   8d 44 24 2c             lea    0x2c(%esp),%eax
 804924a:   89 44 24 10             mov    %eax,0x10(%esp)
 804924e:   8d 44 24 28             lea    0x28(%esp),%eax
 8049252:   89 44 24 0c             mov    %eax,0xc(%esp)
 8049256:   8d 44 24 24             lea    0x24(%esp),%eax
 804925a:   89 44 24 08             mov    %eax,0x8(%esp)
 804925e:   c7 44 24 04 91 a3 04    movl   $0x804a391,0x4(%esp)
 8049265:   08 
 8049266:   c7 04 24 d0 c4 04 08    movl   $0x804c4d0,(%esp)
 804926d:   e8 fe f5 ff ff          call   8048870 &lt;__isoc99_sscanf@plt&gt;</code></pre>

<p>把两个立即数地址传给<code>&lt;__isoc99_sscanf@plt&gt;</code>。查看第一个地址（<code>x/s 0x804a391</code>）发现是<code>&quot;%d %d %s&quot;</code>，应该输入两个整数和一个字符串。后一个地址<code>0x804c4d0</code>应该是输入时的地址，查看每一个关卡输入时的地址，发现<strong>第四关</strong>输入时的地址正好是<code>0x804c4d0</code>。</p>
<p><img src="https://i.loli.net/2021/06/05/x7tO5IuYpvTCgKE.jpg" alt="input4" loading="lazy"></p>
<pre class="language-none"><code class="language-none">8049272:   83 f8 03                cmp    $0x3,%eax
 8049275:   75 35                   jne    80492ac &lt;phase_defused+0x81&gt;
 8049277:   c7 44 24 04 9a a3 04    movl   $0x804a39a,0x4(%esp)
 804927e:   08 
 804927f:   8d 44 24 2c             lea    0x2c(%esp),%eax
 8049283:   89 04 24                mov    %eax,(%esp)
 8049286:   e8 09 fd ff ff          call   8048f94 &lt;strings_not_equal&gt;
 804928b:   85 c0                   test   %eax,%eax
 804928d:   75 1d                   jne    80492ac &lt;phase_defused+0x81&gt;
 804928f:   c7 04 24 60 a2 04 08    movl   $0x804a260,(%esp)
 8049296:   e8 65 f5 ff ff          call   8048800 &lt;puts@plt&gt;
 804929b:   c7 04 24 88 a2 04 08    movl   $0x804a288,(%esp)
 80492a2:   e8 59 f5 ff ff          call   8048800 &lt;puts@plt&gt;
 80492a7:   e8 db fb ff ff          call   8048e87 &lt;secret_phase&gt;
​
 80492ac:   c7 04 24 c0 a2 04 08    movl   $0x804a2c0,(%esp)
 80492b3:   e8 48 f5 ff ff          call   8048800 &lt;puts@plt&gt;
 80492b8:   8b 44 24 7c             mov    0x7c(%esp),%eax
 80492bc:   65 33 05 14 00 00 00    xor    %gs:0x14,%eax
 80492c3:   74 05                   je     80492ca &lt;phase_defused+0x9f&gt;
 80492c5:   e8 06 f5 ff ff          call   80487d0 &lt;__stack_chk_fail@plt&gt;
 80492ca:   81 c4 8c 00 00 00       add    $0x8c,%esp
 80492d0:   c3                      ret</code></pre>

<p>将<code>&lt;__isoc99_sscanf@plt&gt;</code>的返回值与3比较，猜测该返回值应该是参数的数量，等于3才可能解锁隐藏关。然后又传递了一个地址<code>0x804a39a</code>，将该地址处的字符串与输入的字符串比较，相等才能解锁隐藏关。在gdb中输入<code>x/s 0x804a39a</code>，得到该处的字符串是<code>DrEvil</code>。</p>
<p>所以在进行第四关时，输入两个数后再输入<code>DrEvil</code>，通过第六关之后即可进入<code>secret_phase</code>。第四关里面获取输入元素数量也使用了<code>&lt;__isoc99_sscanf@plt&gt;</code>，在那里给的参数是<code>&quot;%d %d&quot;</code>，应该是只能接受两个输入，即使输入了三个，返回值也会是2，第四关的通关不受影响。</p>
<p>进入secret_phase：</p>
<p><img src="https://i.loli.net/2021/06/05/CRqUj6n8Ki7ZlDd.jpg" alt="enter-sp" loading="lazy"></p>
<h4 id="分析secret-phase"><a href="#分析secret-phase" class="headerlink" title="分析secret_phase"></a>分析secret_phase</h4><pre class="language-none"><code class="language-none">08048e87 &lt;secret_phase&gt;:
 8048e87:   53                      push   %ebx
 8048e88:   83 ec 18                sub    $0x18,%esp
 8048e8b:   e8 3d 02 00 00          call   80490cd &lt;read_line&gt;
 8048e90:   c7 44 24 08 0a 00 00    movl   $0xa,0x8(%esp)
 8048e97:   00 
 8048e98:   c7 44 24 04 00 00 00    movl   $0x0,0x4(%esp)
 8048e9f:   00 
 8048ea0:   89 04 24                mov    %eax,(%esp)
 8048ea3:   e8 38 fa ff ff          call   80488e0 &lt;strtol@plt&gt;</code></pre>

<p>由<code>&lt;read_line&gt;</code>可知要有一行输入，然后输入的内容和<code>0xa</code>、<code>0x0</code>两个立即数一起作为<code>&lt;strtol@plt&gt;</code>的参数。<code>&lt;strtol@plt&gt;</code>的作用是把参数按照其base（即进制）转换成长整型数，由此可知应该输入的是一个数。</p>
<pre class="language-none"><code class="language-none">8048ea8:   89 c3                   mov    %eax,%ebx
 8048eaa:   8d 40 ff                lea    -0x1(%eax),%eax
 8048ead:   3d e8 03 00 00          cmp    $0x3e8,%eax
 8048eb2:   76 05                   jbe    8048eb9 &lt;secret_phase+0x32&gt;
 8048eb4:   e8 ed 01 00 00          call   80490a6 &lt;explode_bomb&gt;</code></pre>

<p>输入的数应该小于等于1001。</p>
<pre class="language-none"><code class="language-none">8048eb9:   89 5c 24 04             mov    %ebx,0x4(%esp);
 8048ebd:   c7 04 24 88 c0 04 08    movl   $0x804c088,(%esp)
 8048ec4:   e8 6d ff ff ff          call   8048e36 &lt;fun7&gt;
 8048ec9:   83 f8 07                cmp    $0x7,%eax
 8048ecc:   74 05                   je     8048ed3 &lt;secret_phase+0x4c&gt;
 8048ece:   e8 d3 01 00 00          call   80490a6 &lt;explode_bomb&gt;</code></pre>

<p>把地址<code>0x804c088</code>和输入的数作为参数调用<code>fun7</code>。要求<code>fun7</code>的返回值等于7。</p>
<p>接下来分析<code>fun7</code>：</p>
<p>记<code>fun7</code>的参数为<code>x</code>和<code>y</code>，在<code>secret_phase</code>中调用时<code>x</code>是一个地址。</p>
<pre class="language-none"><code class="language-none">08048e36 &lt;fun7&gt;:
 8048e36:   53                      push   %ebx
 8048e37:   83 ec 18                sub    $0x18,%esp
 8048e3a:   8b 54 24 20             mov    0x20(%esp),%edx
 8048e3e:   8b 4c 24 24             mov    0x24(%esp),%ecx
 8048e42:   85 d2                   test   %edx,%edx
 8048e44:   74 37                   je     8048e7d &lt;fun7+0x47&gt;</code></pre>

<p>它是一个递归函数，当x为0时返回<code>0xffffffff</code>。不过<code>secret_phase</code>传给它的x不为0。</p>
<pre class="language-none"><code class="language-none">8048e46:   8b 1a                   mov    (%edx),%ebx
 8048e48:   39 cb                   cmp    %ecx,%ebx
 8048e4a:   7e 13                   jle    8048e5f &lt;fun7+0x29&gt;
 8048e4c:   89 4c 24 04             mov    %ecx,0x4(%esp)
 8048e50:   8b 42 04                mov    0x4(%edx),%eax
 8048e53:   89 04 24                mov    %eax,(%esp)
 8048e56:   e8 db ff ff ff          call   8048e36 &lt;fun7&gt;
 8048e5b:   01 c0                   add    %eax,%eax
 8048e5d:   eb 23                   jmp    8048e82 &lt;fun7+0x4c&gt;</code></pre>

<p>若x不为0，当x指向的值大于y，将地址x加4，和y一起作为参数调用fun7，返回其返回值的2倍。当x指向的值等于y，返回0。</p>
<pre class="language-none"><code class="language-none">8048e5f:   b8 00 00 00 00          mov    $0x0,%eax
 8048e64:   39 cb                   cmp    %ecx,%ebx
 8048e66:   74 1a                   je     8048e82 &lt;fun7+0x4c&gt;
​
 8048e68:   89 4c 24 04             mov    %ecx,0x4(%esp)
 8048e6c:   8b 42 08                mov    0x8(%edx),%eax
 8048e6f:   89 04 24                mov    %eax,(%esp)
 8048e72:   e8 bf ff ff ff          call   8048e36 &lt;fun7&gt;
​
 8048e77:   8d 44 00 01             lea    0x1(%eax,%eax,1),%eax
 8048e7b:   eb 05                   jmp    8048e82 &lt;fun7+0x4c&gt;</code></pre>

<p>当x指向的值小于y，将地址x加8，和y一起作为参数调用fun7，返回其返回值的2倍加1。</p>
<pre class="language-none"><code class="language-none">8048e7d:   b8 ff ff ff ff          mov    $0xffffffff,%eax
 8048e82:   83 c4 18                add    $0x18,%esp
 8048e85:   5b                      pop    %ebx
 8048e86:   c3                      ret</code></pre>

<p>最终需要的返回值是7，最内层返回值应该是0，即在最内层x所指向的值与y相等，再往外一层返回2<em>0+1，再往外一层返回2</em>1+1，最外层返回2*3+1。</p>
<p>输入<code>x/44x 0x804c088</code>查看保存的值。</p>
<p><img src="https://i.loli.net/2021/06/05/rIbYyvn1j2AHZa7.jpg" alt="values" loading="lazy"></p>
<p><code>secret_phase</code>调用<code>fun7</code>时，x为<code>0x804c088</code>，y是输入的数。</p>
<p><code>0x804c088+8</code>等于<code>0x804c090</code>，该处存放的值为<code>0x804c0a0</code>，是一个地址。</p>
<p><code>0x804c0a0+8</code>等于<code>0x804c0a8</code>，该处存放的值为<code>0x804c0d0</code>，是一个地址。</p>
<p><code>0x804c0d0+8</code>等于<code>0x804c0d8</code>，该处存放的值为<code>0x804c130</code>，是一个地址。</p>
<p>地址<code>0x804c130</code>处保存了一个数，0x3e9，转换成十进制是1001，它应该等于y。</p>
<p>返回到<code>secret_phase</code>:</p>
<pre class="language-none"><code class="language-none">8048ed3:   c7 04 24 00 a2 04 08    movl   $0x804a200,(%esp)
 8048eda:   e8 21 f9 ff ff          call   8048800 &lt;puts@plt&gt;
 8048edf:   e8 47 03 00 00          call   804922b &lt;phase_defused&gt;
 8048ee4:   83 c4 18                add    $0x18,%esp
 8048ee7:   5b                      pop    %ebx
 8048ee8:   c3                      ret</code></pre>

<p><code>fun7(0x804c088, 1001)</code>的返回值应该是7，使得程序输出通关信息，正常返回。也就是说，要通过<code>secret_phase</code>，应该输入<code>1001</code>。</p>
<p>输入<code>1001</code>，终端输出了<code>Wow! You&#39;ve defused the secret stage!</code>，隐藏的秘密关卡通过。</p>
<p><img src="https://i.loli.net/2021/06/05/oSlURyD4XP8NbhZ.jpg" alt="sp" loading="lazy"></p>
<h3 id="通关"><a href="#通关" class="headerlink" title="通关"></a>通关</h3><p><img src="https://i.loli.net/2021/06/05/TpuSW5DxAa8yQje.jpg" alt="victory" loading="lazy"></p>
<p>有几关的答案不唯一。这个实验每个人的题目不太一样，不过在网上能找到很多类似的题解来提供思路。和身边的人对比起来，我抽到的题目算是比较常规吧。邪恶博士，谢谢你（才怪）。</p>
</div></section><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>零歌</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://afool.top/learning/csapp_bomblab/" title="BombLab实验">https://afool.top/learning/csapp_bomblab/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/post/install_air_conditioner/" rel="prev" title="夏天到了，开个空调"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">夏天到了，开个空调</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/learning/machine_level_representation_of_programs/" rel="next" title="3.程序的机器级表示"><span class="post-nav-text">3.程序的机器级表示</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>留个爪印吧~</span><br></div><div id="tcomment"></div><script type="module">import { getScript } from '/js/utils.js'

getScript("https://fastly.jsdelivr.net/npm/twikoo@latest/dist/twikoo.all.min.js", () => {
  const twikooConfig = {"enable":true,"envId":"https://twikoo-afool.vercel.app/"}
  twikooConfig.el = '#tcomment'
  twikoo.init(twikooConfig)
}, window.twikoo);</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2022 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> 零歌</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.3.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.9</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></body></html>